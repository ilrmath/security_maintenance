<!DOCTYPE html>
<!-- saved from url=(0058)file:///Users/kohtasekiya/Desktop/2026-01-30_08-20-26.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>IPãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿç¿’ãƒ‰ãƒªãƒ« (v6.4 æ‰‹å‹•ã§ãƒ«ãƒ¼ã‚¿è¡¨ã‚’é¸æŠ)</title>
  <style>
    :root {
      --bg: #1a202c;
      --panel: #2d3748;
      --text: #e2e8f0;
      --accent: #48bb78; /* ç·‘ */
      --danger: #e53e3e; /* èµ¤ */
      --highlight: #ecc94b; /* é»„è‰² */
      --border: #4a5568;
    }
    body {
      margin: 0; font-family: "Helvetica Neue", Arial, sans-serif;
      background: var(--bg); color: var(--text); padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 480px; gap: 20px; }

    /* å·¦ã‚«ãƒ©ãƒ ï¼ˆå›³ + å›³ä¸‹ã‚¢ãƒ©ãƒ¼ãƒˆé ˜åŸŸï¼‰ */
    .left-col { display: flex; flex-direction: column; gap: 10px; }

    /* --- ãƒˆãƒãƒ­ã‚¸ãƒ¼å›³ --- */
    .topology-area {
      position: relative; height: 550px; background: #171923;
      border: 2px solid var(--border); border-radius: 12px; overflow: hidden;
    }
    svg { width: 100%; height: 100%; position: absolute; top:0; left:0; pointer-events: none; z-index: 1; }
    line { stroke: #718096; stroke-width: 3; opacity: 0.5; }

    .port-label {
      position: absolute; font-size: 11px; font-weight: bold; font-family: monospace;
      color: #1a202c; background: #fbbf24;
      padding: 2px 6px; border-radius: 4px; border: 1px solid #fff;
      transform: translate(-50%, -50%); z-index: 20;
    }
    .node {
      position: absolute; transform: translate(-50%, -50%);
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 13px; z-index: 10; cursor: pointer; transition: 0.2s;
      user-select: none;
    }
    .net {
      width: 90px; height: 45px; border-radius: 25px;
      background: rgba(66, 153, 225, 0.15); border: 2px dashed #63b3ed; color: #90cdf4;
    }

    /* --- ãƒ«ãƒ¼ã‚¿ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
    .router {
      width: 60px; height: 60px; border-radius: 8px;
      background: #edf2f7; color: #1a202c; border: 2px solid #cbd5e0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      flex-direction: column;
      line-height: 1.1;
      gap: 2px;
    }
    .router:hover { transform: translate(-50%, -50%) scale(1.05); }
    .router.selected {
      background: #fff; border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(72, 187, 120, 0.6);
    }
    /* â˜…ãƒ‘ã‚±ãƒƒãƒˆãŒã€Œä»Šã„ã‚‹/ä»Šé€šã£ãŸã€ãƒ«ãƒ¼ã‚¿ã¯å…‰ã‚‰ã›ã‚‹ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯åˆ‡ã‚Šæ›¿ãˆãªã„ï¼‰ */
    .router.forwarding {
      border-color: #f6e05e;
      box-shadow: 0 0 0 4px rgba(236,201,75,0.55), 0 8px 16px rgba(0,0,0,0.35);
    }

    .rt-label { font-size: 10px; color: #4a5568; font-weight: normal; }
    .rt-id { font-size: 20px; font-weight: 800; color: #1a202c; }

    /* ãƒ‘ã‚±ãƒƒãƒˆ */
    .packet {
      position: absolute; width: 20px; height: 20px; background: #f6e05e;
      border-radius: 50%; box-shadow: 0 0 10px #f6e05e;
      transform: translate(-50%, -50%); opacity: 0; pointer-events: none; z-index: 30;
    }

    /* â˜…é¸æŠä¸­ã‚¿ã‚°ï¼ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰ */
    .selected-tag{
      position:absolute;
      z-index:25;              /* port-label(20)ã‚ˆã‚Šä¸Š */
      pointer-events:none;
      font-size:11px;
      font-weight:900;
      padding:4px 10px;
      border-radius:999px;
      background: rgba(72,187,120,0.95); /* accentç·‘ */
      color:#111827;
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
      white-space:nowrap;
      display:none;            /* åˆæœŸã¯éè¡¨ç¤ºï¼ˆupdateSelectedTagã§å‡ºã™ï¼‰ */
    }

    /* å›³ã®ä¸‹ã®è­¦å‘Šæ ï¼ˆãƒ«ãƒ¼ãƒ—è­¦å‘Šãªã©ã‚’ã“ã“ã¸ï¼‰ */
    .topology-alert {
      height: 56px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: #171923;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      box-sizing: border-box;
      opacity: 0;
      transform: translateY(-6px);
      transition: 0.18s ease;
      pointer-events: none;
    }
    .topology-alert.show { opacity: 1; transform: translateY(0); }
    .topology-alert .badge {
      min-width: 30px;
      height: 30px;
      border-radius: 8px;
      display: grid;
      place-items: center;
      font-weight: 900;
      color: #111827;
      background: #fbd38d;
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 6px 14px rgba(0,0,0,0.35);
    }
    .topology-alert.loop { border-color: rgba(229,62,62,0.9); }
    .topology-alert.loop .badge { background: #fc8181; }
    .topology-alert .msg {
      font-weight: 900;
      color: #fde68a;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .topology-alert .hint {
      margin-left: auto;
      font-size: 12px;
      font-weight: 800;
      color: #a7f3d0;
      opacity: 0.9;
      white-space: nowrap;
    }

    /* --- æ“ä½œãƒ‘ãƒãƒ« --- */
    .panel { display: flex; flex-direction: column; gap: 15px; }
    .control-box, .table-box {
      background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 15px;
    }
    .table-box { padding: 0; overflow: hidden; display: flex; flex-direction: column; }

    .table-header {
      padding: 10px; background: rgba(0,0,0,0.2); font-weight: bold;
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
      gap: 10px;
    }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { text-align: left; padding: 10px; color: #a0aec0; border-bottom: 1px solid var(--border); }
    td { padding: 8px 10px; border-bottom: 1px solid var(--border); vertical-align: middle; }

    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes highlightFlash {
      0% { background-color: var(--highlight); color: #000; }
      100% { background-color: transparent; color: var(--accent); }
    }
    .cell-changed { animation: highlightFlash 0.8s ease-out; }

    /* ç¾åœ¨ã®ç›®çš„å®›å…ˆã®è¡Œã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
    tr.active-row td { background: rgba(236, 201, 75, 0.12); }
    tr.active-row td:first-child { border-left: 4px solid var(--highlight); }

    select {
      background: #1a202c; color: #fff; border: 1px solid #718096;
      width: 100%; padding: 10px; border-radius: 4px; font-family: sans-serif; font-size: 13px;
    }
    label { font-size: 11px; color: #a0aec0; display: block; margin-bottom: 5px; font-weight: bold; }

    /* ãƒœã‚¿ãƒ³é¡ */
    .btn-group { display: flex; gap: 10px; margin-top: 15px; }
    button {
      padding: 12px; color: #fff; border: none; font-weight: bold;
      cursor: pointer; border-radius: 4px; font-size: 14px; transition: 0.2s;
    }
    button.btn-run { flex: 2; background: var(--accent); }
    button.btn-run:hover { background: #38a169; }
    button.btn-run:disabled { opacity: 0.5; cursor: not-allowed; background: #718096; }
    button.btn-reset { flex: 1; background: var(--danger); }
    button.btn-reset:hover { background: #c53030; }

    .mini-note {
      margin-top: 10px;
      font-size: 12px;
      color: #cbd5e0;
      line-height: 1.45;
    }
    .mini-note b { color: #fde68a; }

    .posline {
      margin-top: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(0,0,0,0.15);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      font-weight: 800;
      font-size: 12px;
      color: #e2e8f0;
    }
    .posline .tag { color:#a0aec0; font-weight:900; }
    .posline .val { color:#f6e05e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* å³ä¸‹ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆä¸€èˆ¬é€šçŸ¥ç”¨ï¼‰ */
    #toast {
      position: fixed; bottom: 30px; right: 30px; padding: 15px 25px; background: #2d3748;
      border-left: 5px solid var(--accent); color: #fff; transform: translateY(150px); transition: 0.3s;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5); z-index: 100; font-weight: bold; border-radius: 4px;
      max-width: min(520px, calc(100vw - 60px));
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    #toast.show { transform: translateY(0); }
  </style>
</head>
<body>

<div class="container">
  <!-- å·¦ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›³ + å›³ã®ä¸‹ã‚¢ãƒ©ãƒ¼ãƒˆ -->
  <div class="left-col">
    <div class="topology-area" id="topology">
      <svg id="svg-layer"><line x1="70" y1="275" x2="209" y2="275"></line><line x1="209" y1="275" x2="348" y2="275"></line><line x1="348" y1="275" x2="487" y2="275"></line><line x1="348" y1="275" x2="348" y2="110"></line><line x1="348" y1="275" x2="313" y2="468"></line><line x1="487" y1="275" x2="626" y2="275"></line><line x1="348" y1="110" x2="487" y2="110"></line><line x1="313" y1="468" x2="452" y2="468"></line><line x1="452" y1="468" x2="626" y2="468"></line><line x1="626" y1="468" x2="626" y2="275"></line></svg>

      <div class="node net" id="net4" style="left:10%; top:50%">ãƒãƒƒãƒˆ4</div>
      <div class="node net" id="net1" style="left:50%; top:50%">ãƒãƒƒãƒˆ1</div>
      <div class="node net" id="net2" style="left:90%; top:50%">ãƒãƒƒãƒˆ2</div>
      <div class="node net" id="net5" style="left:70%; top:20%">ãƒãƒƒãƒˆ5</div>
      <div class="node net" id="net3" style="left:65%; top:85%">ãƒãƒƒãƒˆ3</div>

      <!-- â˜…ã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤ºã™ã‚‹ãƒ«ãƒ¼ã‚¿è¡¨ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼ˆé€ä¿¡ä¸­ã§ã‚‚OKï¼‰ -->
      <div class="node router selected" id="r1" style="left:30%; top:50%" onclick="selectRouterUI(&#39;r1&#39;)">
          <span class="rt-label">ãƒ«ãƒ¼ã‚¿</span><span class="rt-id">1</span>
      </div>
      <div class="node router" id="r2" style="left:70%; top:50%" onclick="selectRouterUI(&#39;r2&#39;)">
          <span class="rt-label">ãƒ«ãƒ¼ã‚¿</span><span class="rt-id">2</span>
      </div>
      <div class="node router" id="r5" style="left:50%; top:20%" onclick="selectRouterUI(&#39;r5&#39;)">
          <span class="rt-label">ãƒ«ãƒ¼ã‚¿</span><span class="rt-id">5</span>
      </div>
      <div class="node router" id="r4" style="left:45%; top:85%" onclick="selectRouterUI(&#39;r4&#39;)">
          <span class="rt-label">ãƒ«ãƒ¼ã‚¿</span><span class="rt-id">4</span>
      </div>
      <div class="node router" id="r3" style="left:90%; top:85%" onclick="selectRouterUI(&#39;r3&#39;)">
          <span class="rt-label">ãƒ«ãƒ¼ã‚¿</span><span class="rt-id">3</span>
      </div>

      <div class="packet" id="packet" style="transition: left 0.6s linear, top 0.6s linear; left: 90%; top: 50%; opacity: 0;"></div>

      <!-- â˜…è¿½åŠ ï¼šé¸æŠä¸­ã‚¿ã‚°ï¼ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰ -->
      <div class="selected-tag" id="selected-tag" aria-hidden="true" style="display: block; left: 250.397px; top: 237.4px; transform: translate(0px, -100%);">ğŸ’¡é¸æŠä¸­</div>
    <div class="port-label" style="left: 174.25px; top: 275px;">E0</div><div class="port-label" style="left: 243.75px; top: 275px;">E1</div><div class="port-label" style="left: 452.25px; top: 275px;">E0</div><div class="port-label" style="left: 348px; top: 151.25px;">E0</div><div class="port-label" style="left: 321.75px; top: 419.75px;">E0</div><div class="port-label" style="left: 521.75px; top: 275px;">E1</div><div class="port-label" style="left: 382.75px; top: 110px;">E1</div><div class="port-label" style="left: 347.75px; top: 468px;">E1</div><div class="port-label" style="left: 582.5px; top: 468px;">E1</div><div class="port-label" style="left: 626px; top: 419.75px;">E0</div></div>

    <!-- ãƒ«ãƒ¼ãƒ—è­¦å‘Šãªã©ã¯ã“ã“ï¼ˆå›³ã®æ ã®ä¸‹ã®ä½™ç™½ï¼‰ -->
    <div class="topology-alert" id="topology-alert" aria-live="polite">
      <div class="badge">!</div>
      <div class="msg" id="topology-alert-msg">ã€€</div>
      <div class="hint" id="topology-alert-hint">ã€€</div>
    </div>
  </div>

  <!-- å³ï¼šæ“ä½œãƒ‘ãƒãƒ« -->
  <div class="panel">
    <div class="control-box">
      <h3 style="margin:0 0 15px 0; font-size:16px; border-bottom:1px solid #4a5568; padding-bottom:10px;">ğŸ® ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ¼”ç¿’ãƒ‰ãƒªãƒ«</h3>

      <div style="display:flex; flex-direction:column; gap:15px;">
        <div>
          <label>1. å‡ºç™ºåœ° (Start)</label>
          <select id="sel-src" onchange="updateGoalOptions()">
            <option value="net1">ãƒãƒƒãƒˆ1 (ä¸­å¤®)</option>
            <option value="net2">ãƒãƒƒãƒˆ2 (å³ç«¯)</option>
            <option value="net3">ãƒãƒƒãƒˆ3 (ä¸‹éƒ¨)</option>
            <option value="net4">ãƒãƒƒãƒˆ4 (å·¦ç«¯)</option>
            <option value="net5">ãƒãƒƒãƒˆ5 (ä¸Šéƒ¨)</option>
          </select>
        </div>

        <div>
          <label>2. ç›®çš„åœ° (Goal: å…¥å£ã®æŒ‡å®š)</label>
          <select id="sel-dst"><option value="net2|r1">ãƒãƒƒãƒˆ2 (çµŒç”±: ãƒ«ãƒ¼ã‚¿1)</option><option value="net2|r2">ãƒãƒƒãƒˆ2 (çµŒç”±: ãƒ«ãƒ¼ã‚¿2)</option><option value="net2|r5">ãƒãƒƒãƒˆ2 (çµŒç”±: ãƒ«ãƒ¼ã‚¿5)</option><option value="net2|r4">ãƒãƒƒãƒˆ2 (çµŒç”±: ãƒ«ãƒ¼ã‚¿4)</option><option value="net3|r1">ãƒãƒƒãƒˆ3 (çµŒç”±: ãƒ«ãƒ¼ã‚¿1)</option><option value="net3|r2">ãƒãƒƒãƒˆ3 (çµŒç”±: ãƒ«ãƒ¼ã‚¿2)</option><option value="net3|r5">ãƒãƒƒãƒˆ3 (çµŒç”±: ãƒ«ãƒ¼ã‚¿5)</option><option value="net3|r4">ãƒãƒƒãƒˆ3 (çµŒç”±: ãƒ«ãƒ¼ã‚¿4)</option><option value="net4|r1">ãƒãƒƒãƒˆ4 (çµŒç”±: ãƒ«ãƒ¼ã‚¿1)</option><option value="net4|r2">ãƒãƒƒãƒˆ4 (çµŒç”±: ãƒ«ãƒ¼ã‚¿2)</option><option value="net4|r5">ãƒãƒƒãƒˆ4 (çµŒç”±: ãƒ«ãƒ¼ã‚¿5)</option><option value="net4|r4">ãƒãƒƒãƒˆ4 (çµŒç”±: ãƒ«ãƒ¼ã‚¿4)</option><option value="net5|r1">ãƒãƒƒãƒˆ5 (çµŒç”±: ãƒ«ãƒ¼ã‚¿1)</option><option value="net5|r2">ãƒãƒƒãƒˆ5 (çµŒç”±: ãƒ«ãƒ¼ã‚¿2)</option><option value="net5|r5">ãƒãƒƒãƒˆ5 (çµŒç”±: ãƒ«ãƒ¼ã‚¿5)</option><option value="net5|r4">ãƒãƒƒãƒˆ5 (çµŒç”±: ãƒ«ãƒ¼ã‚¿4)</option></select>
          <div class="mini-note">
            â€»é€ä¿¡ä¸­ã§ã‚‚<b>ãƒ†ãƒ¼ãƒ–ãƒ«ã¯è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆã¾ã›ã‚“</b>ã€‚<br>
            å›³ã®ãƒ«ãƒ¼ã‚¿ã‚’<b>ã‚¯ãƒªãƒƒã‚¯ã—ã¦</b>ã€è¦‹ãŸã„ãƒ«ãƒ¼ã‚¿ã®è¡¨ã‚’é–‹ã„ãŸã¾ã¾ä¿®æ­£ã§ãã¾ã™ã€‚
          </div>

          <div class="posline">
            <span class="tag">ãƒ‘ã‚±ãƒƒãƒˆä½ç½®</span>
            <span class="val" id="lbl-pos">ãƒãƒƒãƒˆ2</span>
          </div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-run" onclick="runOrStop()" id="btn-go">ğŸš€ é€ä¿¡ãƒ†ã‚¹ãƒˆ</button>
        <button class="btn-reset" onclick="resetAll()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>

    <div class="table-box">
      <div class="table-header">
        <span id="lbl-table-name">ğŸ“‹ ãƒ«ãƒ¼ã‚¿1 ã®è¨­å®š</span>
        <span style="font-size:11px; color:#ecc94b; font-weight:bold;">â˜…GWã‚’å¤‰ãˆã¦çµŒè·¯ã‚’ä½œã‚ã†</span>
      </div>
      <table>
        <thead>
          <tr>
            <th width="15%">å®›å…ˆ</th>
            <th width="15%">IF</th>
            <th width="50%">ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ (Next Hop)</th>
            <th width="20%">ãƒ¡ãƒˆãƒªãƒƒã‚¯</th>
          </tr>
        </thead>
        <tbody id="tbody-routes"><tr id="row-net1"><td style="font-weight: bold; color: rgb(160, 174, 192);">ãƒãƒƒãƒˆ1</td><td id="cell-if-net1" style="font-weight: bold; color: var(--accent); text-align: center;">E1</td><td><span style="color:var(--accent); font-weight:bold;">âœ… ç›´æ¥æ¥ç¶š</span></td><td id="cell-m-net1" style="text-align: center;">1</td></tr><tr id="row-net2" class="active-row"><td style="font-weight: bold; color: rgb(160, 174, 192);">ãƒãƒƒãƒˆ2</td><td id="cell-if-net2" style="font-weight: bold; color: var(--accent); text-align: center;">E1</td><td><select style="width: 100%;"><option value="0">ãƒ«ãƒ¼ã‚¿2 (GW: ãƒ«ãƒ¼ã‚¿2)</option><option value="1">ãƒ«ãƒ¼ã‚¿4 (GW: ãƒ«ãƒ¼ã‚¿4)</option></select></td><td id="cell-m-net2" style="text-align: center;">2</td></tr><tr id="row-net3"><td style="font-weight: bold; color: rgb(160, 174, 192);">ãƒãƒƒãƒˆ3</td><td id="cell-if-net3" style="font-weight: bold; color: var(--accent); text-align: center;">E1</td><td><select style="width: 100%;"><option value="0">ãƒ«ãƒ¼ã‚¿2 (GW: ãƒ«ãƒ¼ã‚¿2)</option><option value="1">ãƒ«ãƒ¼ã‚¿4 (GW: ãƒ«ãƒ¼ã‚¿4)</option></select></td><td id="cell-m-net3" style="text-align: center;">3</td></tr><tr id="row-net4"><td style="font-weight: bold; color: rgb(160, 174, 192);">ãƒãƒƒãƒˆ4</td><td id="cell-if-net4" style="font-weight: bold; color: var(--accent); text-align: center;">E0</td><td><span style="color:var(--accent); font-weight:bold;">âœ… ç›´æ¥æ¥ç¶š</span></td><td id="cell-m-net4" style="text-align: center;">1</td></tr><tr id="row-net5"><td style="font-weight: bold; color: rgb(160, 174, 192);">ãƒãƒƒãƒˆ5</td><td id="cell-if-net5" style="font-weight: bold; color: var(--accent); text-align: center;">E1</td><td><select style="width: 100%;"><option value="0">ãƒ«ãƒ¼ã‚¿5(æœ€é©) (GW: ãƒ«ãƒ¼ã‚¿5)</option><option value="1">ãƒ«ãƒ¼ã‚¿2(é å›ã‚Š) (GW: ãƒ«ãƒ¼ã‚¿2)</option><option value="2">ãƒ«ãƒ¼ã‚¿4(é å›ã‚Š) (GW: ãƒ«ãƒ¼ã‚¿4)</option></select></td><td id="cell-m-net5" style="text-align: center;">2</td></tr></tbody>
      </table>
    </div>
  </div>
</div>

<div id="toast" class="" style="border-left-color: rgb(72, 187, 120);">ğŸ‰ æˆåŠŸï¼ç›®çš„åœ°ã«åˆ°ç€ã—ã¾ã—ãŸ</div>

<script>
/* === 1. ç‰©ç†æ¥ç¶šãƒ‡ãƒ¼ã‚¿ === */
const LINKS = [
  { a:'net4', b:'r1', portB:'E0' },
  { a:'r1', b:'net1', portA:'E1' },
  { a:'net1', b:'r2', portB:'E0' },
  { a:'net1', b:'r5', portB:'E0' },
  { a:'net1', b:'r4', portB:'E0' },
  { a:'r2', b:'net2', portA:'E1' },
  { a:'r5', b:'net5', portA:'E1' },
  { a:'r4', b:'net3', portA:'E1' },
  { a:'net3', b:'r3', portB:'E1' },
  { a:'r3', b:'net2', portA:'E0' }
];

/* === 2. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ === */
const ROUTE_DB = {
  "r1": {
    "net1": [{ gw:"Direct", if:"E1", m:1, note:"ç›´æ¥" }],
    "net2": [{ gw:"r2", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿2" }, { gw:"r4", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿4" }],
    "net3": [{ gw:"r2", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿2" }, { gw:"r4", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿4" }],
    "net4": [{ gw:"Direct", if:"E0", m:1, note:"ç›´æ¥" }],
    "net5": [
      { gw:"r5", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿5(æœ€é©)" },
      { gw:"r2", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿2(é å›ã‚Š)" },
      { gw:"r4", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿4(é å›ã‚Š)" }
    ]
  },
  "r2": {
    "net1": [{ gw:"Direct", if:"E0", m:1, note:"ç›´æ¥" }],
    "net2": [{ gw:"Direct", if:"E1", m:1, note:"ç›´æ¥" }],
    "net3": [
      { gw:"r4", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿4" },
      { gw:"r3", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿3" }
    ],
    "net4": [
      { gw:"r1", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿1" },
      { gw:"r3", if:"E1", m:4, note:"ãƒ«ãƒ¼ã‚¿3" }
    ],
    "net5": [
      { gw:"r5", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿5" },
      { gw:"r3", if:"E1", m:4, note:"ãƒ«ãƒ¼ã‚¿3" }
    ]
  },
  "r3": {
    "net1": [
      { gw:"r2", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r4", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿4" }
    ],
    "net2": [{ gw:"Direct", if:"E0", m:1, note:"ç›´æ¥" }],
    "net3": [{ gw:"Direct", if:"E1", m:1, note:"ç›´æ¥" }],
    "net4": [
      { gw:"r2", if:"E0", m:3, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r4", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿4" }
    ],
    "net5": [
      { gw:"r2", if:"E0", m:3, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r4", if:"E1", m:3, note:"ãƒ«ãƒ¼ã‚¿4" }
    ]
  },
  "r4": {
    "net1": [{ gw:"Direct", if:"E0", m:1, note:"ç›´æ¥" }],
    "net2": [
      { gw:"r2", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r3", if:"E1", m:2, note:"ãƒ«ãƒ¼ã‚¿3" }
    ],
    "net3": [{ gw:"Direct", if:"E1", m:1, note:"ç›´æ¥" }],
    "net4": [
      { gw:"r1", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿1" },
      { gw:"r3", if:"E1", m:4, note:"ãƒ«ãƒ¼ã‚¿3" }
    ],
    "net5": [
      { gw:"r5", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿5" },
      { gw:"r3", if:"E1", m:4, note:"ãƒ«ãƒ¼ã‚¿3" }
    ]
  },
  "r5": {
    "net1": [{ gw:"Direct", if:"E0", m:1, note:"ç›´æ¥" }],
    "net2": [
      { gw:"r2", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r4", if:"E0", m:4, note:"ãƒ«ãƒ¼ã‚¿4" }
    ],
    "net3": [
      { gw:"r2", if:"E0", m:3, note:"ãƒ«ãƒ¼ã‚¿2" },
      { gw:"r4", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿4" }
    ],
    "net4": [
      { gw:"r1", if:"E0", m:2, note:"ãƒ«ãƒ¼ã‚¿1" },
      { gw:"r2", if:"E0", m:5, note:"ãƒ«ãƒ¼ã‚¿2" }
    ],
    "net5": [{ gw:"Direct", if:"E1", m:1, note:"ç›´æ¥" }]
  }
};

/* === 3. çŠ¶æ…‹ç®¡ç† === */
let currentConfig = {};
function initConfig() {
  ['r1','r2','r3','r4','r5'].forEach(r => {
    currentConfig[r] = {};
    ['net1','net2','net3','net4','net5'].forEach(n => currentConfig[r][n] = 0);
  });
}
initConfig();

let showingRouter = 'r2';

/* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ */
let isRunning = false;
let simRunId = 0; // stopç”¨ãƒˆãƒ¼ã‚¯ãƒ³

/* â˜…æ—¥æœ¬èªåŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°(å®‰å…¨ç‰ˆ)â˜… */
function toJp(id) {
  if (!id) return "";
  if (/^net\d+$/i.test(id)) return id.replace(/^net/i, 'ãƒãƒƒãƒˆ');
  if (/^r\d+$/i.test(id)) return id.replace(/^r/i, 'ãƒ«ãƒ¼ã‚¿');
  return id;
}

window.onload = () => {
  drawTopology();
  selectRouterUI('r2');
  updateGoalOptions();
  window.addEventListener('resize', () => drawTopology());
  updateSelectedTag(); // â˜…è¿½åŠ ï¼ˆä¿é™ºï¼‰
};

/* === ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ === */
function resetAll() {
  if (isRunning) stopSim(true);
  initConfig();
  selectRouterUI(showingRouter);
  toast("ğŸ”„ è¨­å®šã‚’ã™ã¹ã¦åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã—ãŸ", false);
}

/* --- æç”»ç³» --- */
function drawTopology() {
  const svg = document.getElementById('svg-layer');
  const area = document.getElementById('topology');
  svg.innerHTML = '';
  document.querySelectorAll('.port-label').forEach(e => e.remove());

  LINKS.forEach(l => {
    const e1 = document.getElementById(l.a);
    const e2 = document.getElementById(l.b);
    const x1 = e1.offsetLeft, y1 = e1.offsetTop;
    const x2 = e2.offsetLeft, y2 = e2.offsetTop;

    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1', x1); line.setAttribute('y1', y1);
    line.setAttribute('x2', x2); line.setAttribute('y2', y2);
    svg.appendChild(line);

    if(l.portA) addLabel(area, x1,y1, x2,y2, l.portA);
    if(l.portB) addLabel(area, x2,y2, x1,y1, l.portB);
  });

  updateSelectedTag(); // â˜…è¿½åŠ ï¼šãƒªã‚µã‚¤ã‚º/å†æç”»ã§è¿½å¾“
}

function addLabel(area, x1,y1, x2,y2, text) {
  const lbl = document.createElement('div');
  lbl.className = 'port-label'; lbl.innerText = text;
  const dx = x2 - x1, dy = y2 - y1;
  const dist = Math.sqrt(dx*dx + dy*dy);
  let ratio = 0.25; if(dist < 100) ratio = 0.35;
  lbl.style.left = (x1 + dx * ratio) + 'px';
  lbl.style.top = (y1 + dy * ratio) + 'px';
  area.appendChild(lbl);
}

/* â˜…è¿½åŠ ï¼šé¸æŠä¸­ã‚¿ã‚°ã‚’ã€Œç·‘å°ã®ãƒ«ãƒ¼ã‚¿ã€ã®è¿‘ãã«ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆãƒãƒ¼ãƒˆãƒ©ãƒ™ãƒ«ã‚’é‚ªé­”ã—ã«ãã„é€€é¿ä»˜ãï¼‰ */
function updateSelectedTag() {
  const tag = document.getElementById('selected-tag');
  const area = document.getElementById('topology');
  const sel = document.getElementById(showingRouter);
  if (!tag || !area || !sel) return;

  // ã‚µã‚¤ã‚ºè¨ˆæ¸¬ã®ãŸã‚è¡¨ç¤º
  tag.style.display = 'block';

  const areaRect = area.getBoundingClientRect();
  const rRect = sel.getBoundingClientRect();

  const tagW = tag.offsetWidth;
  const tagH = tag.offsetHeight;

  const margin = 6;

  // åŸºæœ¬ï¼šå³ä¸Š
  let left = (rRect.right - areaRect.left) + margin;
  let topBase = (rRect.top - areaRect.top) - margin;

  // å³ã«ã¯ã¿å‡ºã™â†’å·¦ã¸é€€é¿
  if (left + tagW > area.clientWidth - margin) {
    left = (rRect.left - areaRect.left) - margin - tagW;
  }
  // å·¦ã«ã‚‚ã¯ã¿å‡ºã™â†’ã‚¯ãƒ©ãƒ³ãƒ—
  if (left < margin) left = margin;

  // ä¸Šã«ã¯ã¿å‡ºã™â†’ä¸‹ã¸é€€é¿
  let useAbove = true;
  if (topBase < tagH + margin) useAbove = false;

  tag.style.left = left + 'px';

  if (useAbove) {
    tag.style.top = topBase + 'px';
    tag.style.transform = 'translate(0, -100%)';
  } else {
    tag.style.top = (rRect.bottom - areaRect.top + margin) + 'px';
    tag.style.transform = 'translate(0, 0)';
  }
}

function selectRouterUI(rid) {
  showingRouter = rid;

  // é¸æŠè¡¨ç¤ºï¼ˆã“ã‚Œã¯ã€Œè¡¨ã¨ã—ã¦è¦‹ã¦ã„ã‚‹ãƒ«ãƒ¼ã‚¿ã€ï¼‰
  document.querySelectorAll('.router').forEach(e => e.classList.remove('selected'));
  document.getElementById(rid).classList.add('selected');

  document.getElementById('lbl-table-name').innerText = `ğŸ“‹ ${toJp(rid)} ã®è¨­å®š`;
  renderTable();

  updateSelectedTag(); // â˜…è¿½åŠ ï¼šã‚¯ãƒªãƒƒã‚¯ã§è¿½å¾“
}

function renderTable() {
  const tbody = document.getElementById('tbody-routes');
  tbody.innerHTML = '';
  const rid = showingRouter;
  const dests = ['net1','net2','net3','net4','net5'];

  dests.forEach(d => {
    const opts = ROUTE_DB[rid][d];
    if(!opts) return;

    const tr = document.createElement('tr');
    tr.id = `row-${d}`;
    const curIdx = currentConfig[rid][d];
    const safeIdx = (Number.isInteger(curIdx) && curIdx >= 0 && curIdx < opts.length) ? curIdx : 0;
    currentConfig[rid][d] = safeIdx;
    const curRoute = opts[safeIdx];

    const tdDest = document.createElement('td');
    tdDest.style.fontWeight = "bold";
    tdDest.style.color = "#a0aec0";
    tdDest.innerText = toJp(d);

    const tdIF = document.createElement('td');
    tdIF.id = `cell-if-${d}`;
    tdIF.style.fontWeight = "bold";
    tdIF.style.color = "var(--accent)";
    tdIF.style.textAlign = "center";
    tdIF.innerText = curRoute.if;

    const tdGw = document.createElement('td');
    if(curRoute.gw === 'Direct') {
      tdGw.innerHTML = '<span style="color:var(--accent); font-weight:bold;">âœ… ç›´æ¥æ¥ç¶š</span>';
    } else {
      const sel = document.createElement('select');
      sel.style.width = '100%';
      sel.onchange = function() { changeRoute(rid, d, this.value); };

      opts.forEach((opt, idx) => {
        const el = document.createElement('option');
        el.value = idx;
        el.text = `${opt.note} (GW: ${toJp(opt.gw)})`;
        if(idx === safeIdx) el.selected = true;
        sel.appendChild(el);
      });
      tdGw.appendChild(sel);
    }

    const tdMet = document.createElement('td');
    tdMet.id = `cell-m-${d}`;
    tdMet.style.textAlign = "center";
    tdMet.innerText = curRoute.m;

    tr.appendChild(tdDest);
    tr.appendChild(tdIF);
    tr.appendChild(tdGw);
    tr.appendChild(tdMet);
    tbody.appendChild(tr);
  });

  const dstVal = document.getElementById('sel-dst').value;
  if (dstVal) {
    const dst = dstVal.split('|')[0];
    document.querySelectorAll('tbody tr').forEach(tr => tr.classList.remove('active-row'));
    const row = document.getElementById(`row-${dst}`);
    if(row) row.classList.add('active-row');
  }
}

function changeRoute(rid, dest, valIdx) {
  const newVal = parseInt(valIdx, 10);
  currentConfig[rid][dest] = newVal;

  const newRouteData = ROUTE_DB[rid][dest][newVal];

  const ifCell = document.getElementById(`cell-if-${dest}`);
  if(ifCell) {
    ifCell.innerText = newRouteData.if;
    ifCell.classList.remove('cell-changed');
    void ifCell.offsetWidth;
    ifCell.classList.add('cell-changed');
  }
  const mCell = document.getElementById(`cell-m-${dest}`);
  if(mCell) {
    mCell.innerText = newRouteData.m;
    mCell.classList.remove('cell-changed');
    void mCell.offsetWidth;
    mCell.classList.add('cell-changed');
  }
}

function updateGoalOptions() {
  const src = document.getElementById('sel-src').value;
  const dstSelect = document.getElementById('sel-dst');
  dstSelect.innerHTML = '';

  const dests = ['net1','net2','net3','net4','net5'];
  const neighbors = getNeighbors(src).filter(n => n.startsWith('r'));

  dests.forEach(d => {
    if (d === src) return;
    neighbors.forEach(gw => {
      const opt = document.createElement('option');
      opt.value = `${d}|${gw}`;
      opt.text = `${toJp(d)} (çµŒç”±: ${toJp(gw)})`;
      dstSelect.appendChild(opt);
    });
  });

  if(dstSelect.options.length > 0) dstSelect.selectedIndex = 0;
  renderTable();
}

/* ====== å›³ã®ä¸‹ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ«ãƒ¼ãƒ—è­¦å‘Šã¯ã“ã“ã¸ï¼‰ ====== */
let topoAlertTimer = null;
function showTopoAlertLoop(message, hint="GWã‚’å¤‰ãˆã¦è„±å‡ºã—ã‚ˆã†") {
  const box = document.getElementById('topology-alert');
  const msg = document.getElementById('topology-alert-msg');
  const h = document.getElementById('topology-alert-hint');

  box.classList.add('loop');
  msg.textContent = message;
  h.textContent = hint;

  box.classList.add('show');

  clearTimeout(topoAlertTimer);
  topoAlertTimer = setTimeout(() => {
    box.classList.remove('show');
  }, 2600);
}
function clearTopoAlert() {
  const box = document.getElementById('topology-alert');
  box.classList.remove('show');
}

/* ====== ãƒ‘ã‚±ãƒƒãƒˆä½ç½®è¡¨ç¤ºï¼†ãƒ«ãƒ¼ã‚¿ç‚¹ç¯ï¼ˆè¡¨ã¯åˆ‡ã‚Šæ›¿ãˆãªã„ï¼‰ ====== */
function setPacketPosLabel(id) {
  document.getElementById('lbl-pos').textContent = toJp(id);
}
function markForwardingRouter(rid) {
  document.querySelectorAll('.router').forEach(e => e.classList.remove('forwarding'));
  const el = document.getElementById(rid);
  if (el) el.classList.add('forwarding');
}

/* ====== é€ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå‹•çš„åæ˜ ç‰ˆ / æ‰‹å‹•ã§è¡¨ã‚’é¸æŠï¼‰ ====== */
function runOrStop() {
  if (isRunning) stopSim(false);
  else startSim();
}

function setRunningUI(running) {
  const btn = document.getElementById('btn-go');
  btn.textContent = running ? "â¹ åœæ­¢" : "ğŸš€ é€ä¿¡ãƒ†ã‚¹ãƒˆ";
  document.getElementById('sel-src').disabled = running;
  document.getElementById('sel-dst').disabled = running;
}

function stopSim(silent) {
  isRunning = false;
  simRunId++;
  setRunningUI(false);

  const pkt = document.getElementById('packet');
  pkt.style.opacity = 0;

  clearTopoAlert();
  document.querySelectorAll('.router').forEach(e => e.classList.remove('forwarding'));
  setPacketPosLabel("â€”");

  if (!silent) toast("â¹ åœæ­¢ã—ã¾ã—ãŸï¼ˆè¨­å®šã¯ä¿æŒã•ã‚Œã¦ã„ã¾ã™ï¼‰", false);
}

function detectLoop(hist) {
  if (hist.length < 4) return false;
  const n = hist.length;
  const a = hist[n-1], b = hist[n-2], c = hist[n-3], d = hist[n-4];
  if (a === c && b === d && a !== b) return true; // ABAB
  if (a === b && b === c) return true; // AAA
  return false;
}

async function startSim() {
  if(isRunning) return;

  const src = document.getElementById('sel-src').value;
  const dstVal = document.getElementById('sel-dst').value;
  if(!dstVal) return;

  const [targetDst, firstHop] = dstVal.split('|');
  if(!targetDst || !firstHop) return;

  isRunning = true;
  const myRun = ++simRunId;
  setRunningUI(true);

  const pkt = document.getElementById('packet');
  const startEl = document.getElementById(src);

  pkt.style.transition = 'none';
  pkt.style.left = startEl.style.left;
  pkt.style.top = startEl.style.top;
  pkt.style.opacity = 1;

  setPacketPosLabel(src);

  await wait(50);
  if (!isRunning || myRun !== simRunId) return;

  pkt.style.transition = 'left 0.6s linear, top 0.6s linear';

  toast(`ğŸš€ é€ä¿¡é–‹å§‹: ${toJp(src)} â†’ ${toJp(firstHop)}ï¼ˆç›®æ¨™: ${toJp(targetDst)}ï¼‰`);

  // åˆæ‰‹: srcãƒãƒƒãƒˆ â†’ firstHopãƒ«ãƒ¼ã‚¿
  await animTo(firstHop);
  if (!isRunning || myRun !== simRunId) return;

  let currentRouter = firstHop;
  const hopStack = [];

  let lastLoopAlert = 0;
  let lastNoRouteToast = 0;
  const routerHist = [];

  while (isRunning && myRun === simRunId) {

    routerHist.push(currentRouter);
    if (routerHist.length > 12) routerHist.shift();

    // ãƒ«ãƒ¼ãƒ—è­¦å‘Šï¼ˆå›³ã®ä¸‹ã¸ï¼‰
    if (detectLoop(routerHist) && Date.now() - lastLoopAlert > 900) {
      showTopoAlertLoop("ğŸ” ãƒ«ãƒ¼ãƒ—ä¸­ã£ã½ã„ï¼ãƒ‘ã‚±ãƒƒãƒˆãŒå¾€å¾©ã—ã¦ã„ã¾ã™", "ãƒ«ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ã‚’å›ºå®šã—ã€GWã‚’ä¿®æ­£");
      lastLoopAlert = Date.now();
    }

    // è€ƒãˆã‚‹çŒ¶äºˆ
    await wait(350);
    if (!isRunning || myRun !== simRunId) break;

    const routerOpts = ROUTE_DB[currentRouter]?.[targetDst];

    // çµŒè·¯è‡ªä½“ãŒç„¡ã„ â†’ æˆ»ã‚‹ï¼ˆå¾€å¾©ç¶™ç¶šï¼‰
    if (!routerOpts) {
      if (Date.now() - lastNoRouteToast > 2500) {
        toast(`âš ï¸ ${toJp(currentRouter)}: ${toJp(targetDst)} ã¸ã®çµŒè·¯ãªã— â†’ æˆ»ã‚Šã¾ã™ï¼ˆè¨­å®šå¤‰æ›´ã§è§£æ±ºï¼‰`, true);
        lastNoRouteToast = Date.now();
      }
      await bounceBack(currentRouter, src, firstHop, hopStack, myRun);
      currentRouter = bounceBack._currentRouter;
      continue;
    }

    // â˜…ã“ã“ãŒã€Œå‹•çš„åæ˜ ã€ï¼šãƒ¦ãƒ¼ã‚¶ãŒä»Šå¤‰ãˆãŸcurrentConfigã‚’æ¯å›èª­ã¿ç›´ã™
    let idx = currentConfig[currentRouter][targetDst];
    if (!Number.isInteger(idx) || idx < 0 || idx >= routerOpts.length) idx = 0;

    const route = routerOpts[idx];

    // ç›´æ¥æ¥ç¶šãªã‚‰ç›®çš„ãƒãƒƒãƒˆã¸
    if (route.gw === 'Direct') {
      await animTo(targetDst);
      if (!isRunning || myRun !== simRunId) break;

      clearTopoAlert();
      toast("ğŸ‰ æˆåŠŸï¼ç›®çš„åœ°ã«åˆ°ç€ã—ã¾ã—ãŸ", false, true);

      await wait(450);
      pkt.style.opacity = 0;
      isRunning = false;
      setRunningUI(false);
      document.querySelectorAll('.router').forEach(e => e.classList.remove('forwarding'));
      break;
    }

    const nextRouter = route.gw;
    const commonNet = findCommonNet(currentRouter, nextRouter);

    if (!commonNet) {
      if (Date.now() - lastNoRouteToast > 2500) {
        toast(`âš ï¸ ${toJp(currentRouter)} â†’ ${toJp(nextRouter)} ã®å…±é€šãƒãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ â†’ æˆ»ã‚Šã¾ã™`, true);
        lastNoRouteToast = Date.now();
      }
      await bounceBack(currentRouter, src, firstHop, hopStack, myRun);
      currentRouter = bounceBack._currentRouter;
      continue;
    }

    // æˆ»ã‚‹æ¼”å‡ºç”¨ã«è¨˜éŒ²
    hopStack.push({ fromRouter: currentRouter, viaNet: commonNet });

    // router -> net -> router
    await animTo(commonNet);
    if (!isRunning || myRun !== simRunId) break;

    await animTo(nextRouter);
    if (!isRunning || myRun !== simRunId) break;

    currentRouter = nextRouter;
  }
}

async function bounceBack(currentRouter, srcNet, firstHop, hopStack, myRun) {
  if (hopStack.length > 0) {
    const back = hopStack.pop();
    await animTo(back.viaNet);
    if (!isRunning || myRun !== simRunId) return (bounceBack._currentRouter = currentRouter);
    await animTo(back.fromRouter);
    bounceBack._currentRouter = back.fromRouter;
    return;
  }
  await animTo(srcNet);
  if (!isRunning || myRun !== simRunId) return (bounceBack._currentRouter = currentRouter);
  await animTo(firstHop);
  bounceBack._currentRouter = firstHop;
}

/* â˜…ç§»å‹•ï¼šãƒ‘ã‚±ãƒƒãƒˆä½ç½®è¡¨ç¤ºï¼†ãƒ«ãƒ¼ã‚¿ç‚¹ç¯ï¼ˆè¡¨ã¯åˆ‡ã‚Šæ›¿ãˆãªã„ï¼‰ */
function animTo(targetId) {
  return new Promise(resolve => {
    const el = document.getElementById(targetId);
    const pkt = document.getElementById('packet');

    // è¡¨ç¤ºç³»
    setPacketPosLabel(targetId);
    if (targetId.startsWith('r')) markForwardingRouter(targetId);

    pkt.style.left = el.style.left;
    pkt.style.top = el.style.top;
    setTimeout(resolve, 600);
  });
}

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
function findCommonNet(id1, id2) {
  const n1 = getNeighbors(id1), n2 = getNeighbors(id2);
  return n1.find(n => n.startsWith('net') && n2.includes(n));
}
function getNeighbors(id) {
  return LINKS.filter(l => l.a===id || l.b===id).map(l => l.a===id ? l.b : l.a);
}

function toast(msg, isErr=false, isSuccess=false) {
  const t = document.getElementById('toast');
  t.innerText = msg;
  t.style.borderLeftColor = isErr ? '#fc8181' : (isSuccess ? '#48bb78' : '#ed8936');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 3000);
}
function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
</script>


</body></html>
